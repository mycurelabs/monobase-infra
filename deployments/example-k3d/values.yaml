# k3d Local Development Configuration Example
# Complete reference for local k3d testing
# Optimized for laptop/workstation development

global:
  domain: local.test
  namespace: monobase-dev
  environment: development

  gateway:
    name: shared-gateway
    namespace: gateway-system

  # Use k3d's built-in storage
  storage:
    provider: local-path
    className: local-path

# ===== CORE: API (Minimal) =====
api:
  enabled: true
  replicas: 1  # Single replica for testing

  image:
    tag: "latest"  # OK for local testing

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  autoscaling:
    enabled: false

  gateway:
    hostname: api.local.test

# ===== CORE: Account =====
account:
  enabled: true
  replicas: 1

  image:
    repository: ghcr.io/YOUR-ORG/monobase-account
    pullPolicy: IfNotPresent
    tag: "latest"

  podSecurityContext:
    runAsUser: 101  # nginx user
    runAsNonRoot: true
    fsGroup: 101  # nginx group owns the volumes

  securityContext:
    readOnlyRootFilesystem: true
    capabilities:
      drop:
        - ALL

  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

# ===== CORE: PostgreSQL (Single-node for testing) =====
postgresql:
  enabled: true
  architecture: standalone  # Standalone mode for testing (no replication)

  # Override image to use rolling tag
  image:
    tag: "16"  # Rolling tag - always latest PostgreSQL 16.x

  persistence:
    enabled: true
    storageClass: local-path
    size: 1Gi  # Minimal for testing

  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 1
      memory: 1Gi

# ===== OPTIONAL: Valkey (Redis cache) =====
valkey:
  enabled: true
  architecture: standalone  # No replication for local testing

  master:
    persistence:
      enabled: false  # Disabled for local testing

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 250m
      memory: 256Mi

# ===== OPTIONAL: MinIO (Disabled - Too Heavy) =====
minio:
  enabled: false
  # Use external S3 or skip file uploads in testing

# ===== OPTIONAL: Mailpit (Enabled for Email Testing) =====
mailpit:
  enabled: true  # Good for local email testing

# ===== External Secrets (Simplified for Local) =====
externalSecrets:
  enabled: false  # Use plain Kubernetes Secrets for local testing
  # Or use SOPS for encrypted local secrets

# ===== Monitoring (Disabled - Too Heavy) =====
monitoring:
  enabled: false

# ===== Backup (Disabled for Local) =====
backup:
  enabled: false

# ===== Network Policies (Optional for Local) =====
networkPolicies:
  enabled: false  # Can enable to test policies

# ===== Pod Security Standards =====
podSecurityStandards:
  enabled: true  # Test PSS compliance
  level: restricted

# ===== Autoscaling (Disabled) =====
autoscaling:
  enabled: false

# ===== Resource Quotas (Disabled) =====
resourceQuotas:
  enabled: false

# Notes for k3d Testing:
# - Minimal resources (laptop-friendly)
# - Single replicas (no HA overhead)
# - Standalone PostgreSQL (no replication overhead)
# - No MinIO (too heavy)
# - Monitoring disabled (save RAM)
# - Local storage only
# - Perfect for development and testing
