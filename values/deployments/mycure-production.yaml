# MyCure Production Configuration
# Production environment on DigitalOcean Kubernetes (DOKS)

global:
  domain: mycureapp.com
  namespace: mycure-production
  environment: production

  nodePool: "production"

  gateway:
    name: shared-gateway
    namespace: gateway-system

  storage:
    provider: ""
    className: ""

# ===== CORE: Monobase API =====
api:
  enabled: false

  image:
    repository: ghcr.io/monobaselabs/api
    tag: "0.1.4"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  gateway:
    hostname: ""

  livenessProbe:
    enabled: true

  readinessProbe:
    enabled: true

  podDisruptionBudget:
    enabled: false

  autoscaling:
    enabled: false

  backup:
    enabled: false

  externalSecrets:
    enabled: false

  postgresql:
    serviceName: postgresql
    architecture: standalone
    auth:
      database: postgres
      username: postgres

  mailpit:
    enabled: true

# ===== CORE: Monobase Account Frontend =====
account:
  enabled: false

  image:
    repository: ghcr.io/monobaselabs/accountapp
    tag: "1.0.2"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  gateway:
    hostname: ""

  config:
    API_URL: "https://hapihub.mycureapp.com"

  podDisruptionBudget:
    enabled: false

# ===== HEALTHCARE: HapiHub API =====
hapihub:
  enabled: true

  image:
    repository: ghcr.io/mycurelabs/hapihub
    tag: "10.0.25"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    requests:
      cpu: 500m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1Gi

  gateway:
    hostname: ""
    sectionName: https  # Use HTTPS listener with wildcard TLS certificate
    timeouts:
      request: "60s"

  env:
    - name: CLUSTER_INSTANCES
      value: "1"
    - name: BETTER_AUTH_RATE_LIMIT_ENABLED
      value: "true"
    - name: BETTER_AUTH_RATE_LIMIT_WINDOW
      value: "60"
    - name: BETTER_AUTH_RATE_LIMIT_MAX
      value: "300"

  livenessProbe:
    enabled: true

  readinessProbe:
    enabled: true

  podDisruptionBudget:
    enabled: false

  autoscaling:
    enabled: false

  externalSecrets:
    enabled: true
    secretStore: gcp-secretstore
    secretStoreKind: ClusterSecretStore
    refreshInterval: 1h
    secrets:
      - secretKey: GOOGLE_CLIENT_ID
        remoteKey: mycure-production-google-oauth-client-id
      - secretKey: GOOGLE_CLIENT_SECRET
        remoteKey: mycure-production-google-oauth-client-secret
      - secretKey: STRIPE_SECRET_KEY
        remoteKey: mycure-production-stripe-secret-key

  mongodb:
    serviceName: mongodb
    database: hapihub
    username: root
    replicaSet: rs0

# ===== HEALTHCARE: Frontend Application =====
mycure:
  enabled: true

  image:
    repository: ghcr.io/mycurelabs/mycureapp
    tag: "10.2.4"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  gateway:
    hostname: ""
    sectionName: https  # Use HTTPS listener with wildcard TLS certificate

  config:
    API_URL: "https://hapihub.mycureapp.com"
    HAPIHUB_URL: "https://hapihub.mycureapp.com"

  podDisruptionBudget:
    enabled: false

# ===== HEALTHCARE: Frontend Application (v8 Legacy) =====
mycurev8:
  enabled: true

  image:
    repository: ghcr.io/mycurelabs/mycureapp
    tag: "8.22.4"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  gateway:
    hostname: ""
    sectionName: https  # Use HTTPS listener with wildcard TLS certificate

  config:
    API_URL: "https://hapihub.mycureapp.com"
    HAPIHUB_URL: "https://hapihub.mycureapp.com"

  podDisruptionBudget:
    enabled: false

# ===== HEALTHCARE: DentaLemon Dental Application =====
dentalemon:
  enabled: true

  image:
    repository: ghcr.io/mycurelabs/dentalemonapp
    tag: "10.0.0"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  gateway:
    hostname: ""
    sectionName: https  # Use HTTPS listener with wildcard TLS certificate

  config:
    API_URL: "https://hapihub.mycureapp.com"
    HAPIHUB_URL: "https://hapihub.mycureapp.com"

  podDisruptionBudget:
    enabled: false

# ===== HEALTHCARE: SyncD Real-time Synchronization =====
syncd:
  enabled: true

  image:
    repository: ghcr.io/mycurelabs/syncd
    tag: "5.130.24"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    requests:
      cpu: 250m
      memory: 384Mi
    limits:
      cpu: "2"
      memory: 4Gi

  gateway:
    hostname: ""
    sectionName: https  # Use HTTPS listener with wildcard TLS certificate

  livenessProbe:
    enabled: true

  readinessProbe:
    enabled: true

  podDisruptionBudget:
    enabled: false

  autoscaling:
    enabled: false

  externalSecrets:
    enabled: false

  mongodb:
    serviceName: mongodb
    database: hapihub
    username: root
    replicaSet: rs0

# ===== DATABASE: PostgreSQL =====
postgresql:
  enabled: true

  fullnameOverride: "postgresql"

  architecture: standalone

  image:
    repository: bitnamilegacy/postgresql
    tag: 16.4.0-debian-12-r13

  auth:
    enabled: true
    existingSecret: postgresql
    secretKeys:
      adminPasswordKey: postgres-password

  persistence:
    enabled: true
    storageClass: ""
    size: 20Gi

  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 1Gi

  podDisruptionBudget:
    enabled: false

# ===== DATABASE: MongoDB =====
mongodb:
  enabled: true

  fullnameOverride: "mongodb"

  architecture: replicaset
  replicaCount: 1

  image:
    repository: bitnamilegacy/mongodb
    tag: 7.0.15-debian-12-r0

  auth:
    rootUser: root
    existingSecret: mongodb

  arbiter:
    enabled: false

  persistence:
    enabled: true
    storageClass: ""
    size: 20Gi

  resources:
    requests:
      cpu: 100m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 1Gi

  podDisruptionBudget:
    enabled: false

# ===== CACHE: Valkey (Redis) =====
valkey:
  enabled: false

  architecture: standalone

  image:
    repository: bitnamilegacy/valkey
    tag: 8.0.1-debian-12-r2

  master:
    persistence:
      enabled: true
      storageClass: ""
      size: 4Gi

  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 250m
      memory: 256Mi

# ===== STORAGE: MinIO Object Storage =====
minio:
  enabled: false

  fullnameOverride: "minio"

  image:
    repository: bitnamilegacy/minio
    tag: "2025.7.23-debian-12-r3"

  mode: standalone
  
  statefulset:
    replicaCount: 1

  auth:
    existingSecret: minio

  persistence:
    enabled: true
    storageClass: ""
    size: 10Gi

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  defaultBuckets: "monobase-files"
  
  buckets:
    - name: "monobase-files"
  region: "us-east-1"

  podSecurityContext:
    enabled: true
    fsGroup: 1001
    fsGroupChangePolicy: "OnRootMismatch"

  containerSecurityContext:
    enabled: true
    runAsUser: 1001
    runAsGroup: 1001
    runAsNonRoot: true
    privileged: false
    readOnlyRootFilesystem: true
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    seccompProfile:
      type: RuntimeDefault

  gateway:
    enabled: true
    hostname: ""
    rateLimit:
      enabled: false

# ===== EMAIL TESTING: Mailpit =====
mailpit:
  enabled: false

  resources:
    requests:
      cpu: 25m
      memory: 32Mi
    limits:
      cpu: 100m
      memory: 64Mi

  gateway:
    enabled: true
    hostname: ""

# ===== BACKUP =====
backup:
  enabled: false

# ===== SECURITY =====
podSecurityStandards:
  enabled: true
  level: restricted

# ===== RESOURCE QUOTAS =====
resourceQuotas:
  enabled: false
