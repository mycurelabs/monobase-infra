# MyCure Production Configuration
# Production environment on DigitalOcean Kubernetes (DOKS)

global:
  domain: localfirsthealth.com
  namespace: mycure-production
  environment: production

  nodePool: "production"

  gateway:
    name: shared-gateway
    namespace: gateway-system

  storage:
    provider: ""
    className: ""

# ===== CORE: Monobase API =====
api:
  enabled: false

  image:
    repository: ghcr.io/monobaselabs/api
    tag: "0.1.4"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  gateway:
    hostname: ""

  livenessProbe:
    enabled: true

  readinessProbe:
    enabled: true

  podDisruptionBudget:
    enabled: false

  autoscaling:
    enabled: false

  backup:
    enabled: false

  externalSecrets:
    enabled: false

  postgresql:
    serviceName: postgresql
    architecture: standalone
    auth:
      database: postgres
      username: postgres

  mailpit:
    enabled: true

# ===== CORE: Monobase Account Frontend =====
account:
  enabled: false

  image:
    repository: ghcr.io/monobaselabs/accountapp
    tag: "1.0.2"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  gateway:
    hostname: ""

  config:
    API_URL: "https://hapihub.localfirsthealth.com"

  podDisruptionBudget:
    enabled: false

# ===== HEALTHCARE: HapiHub API =====
hapihub:
  enabled: true

  image:
    repository: ghcr.io/mycurelabs/hapihub
    tag: "10.11.17"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    requests:
      cpu: 1000m
      memory: 768Mi
    limits:
      cpu: "2"
      memory: 2Gi

  gateway:
    hostnames:
      - hapihub.localfirsthealth.com
      - api.mycure.md
    sectionName: https-lfh # Use localfirsthealth.com HTTPS listener
    additionalSectionNames:
      - https-mycure
    timeouts:
      request: "60s"

  betterAuth:
    passkey:
      rpName: "Mycure"
      rpId: "localfirsthealth.com"

  env:
    - name: BETTER_AUTH_RATE_LIMIT_ENABLED
      value: "true"
    - name: BETTER_AUTH_RATE_LIMIT_WINDOW
      value: "60"
    - name: BETTER_AUTH_RATE_LIMIT_MAX
      value: "300"
    - name: BETTER_AUTH_SESSION_COOKIE_CACHE_ENABLED
      value: "false"

  livenessProbe:
    enabled: true

  readinessProbe:
    enabled: true

  podDisruptionBudget:
    enabled: false

  autoscaling:
    enabled: true
    maxReplicas: 3

  externalSecrets:
    enabled: true
    secretStore: gcp-secretstore
    secretStoreKind: ClusterSecretStore
    refreshInterval: 1h
    secrets:
      # Google OAuth
      - secretKey: GOOGLE_CLIENT_ID
        remoteKey: mycure-production-google-oauth-client-id
      - secretKey: GOOGLE_CLIENT_SECRET
        remoteKey: mycure-production-google-oauth-client-secret
      - secretKey: STRIPE_SECRET_KEY
        remoteKey: mycure-production-stripe-secret-key
      # Encryption keys
      - secretKey: ENC_BILLING_INVOICES
        remoteKey: mycure-production-enc-billing-invoices
      - secretKey: ENC_BILLING_ITEMS
        remoteKey: mycure-production-enc-billing-items
      - secretKey: ENC_BILLING_PAYMENTS
        remoteKey: mycure-production-enc-billing-payments
      - secretKey: ENC_MEDICAL_RECORDS
        remoteKey: mycure-production-enc-medical-records
      - secretKey: ENC_PERSONAL_DETAILS
        remoteKey: mycure-production-enc-personal-details
      # MongoDB URI (managed DigitalOcean)
      - secretKey: MONGO_URI
        remoteKey: mycure-production-mongo-uri
      # JWT/Auth keys
      - secretKey: PRIVATE_KEY
        remoteKey: mycure-production-private-key
      - secretKey: PUBLIC_KEY
        remoteKey: mycure-production-public-key
      # Storage configuration (GCP)
      - secretKey: STORAGE_BUCKET
        remoteKey: mycure-production-storage-bucket
      - secretKey: STORAGE_CLIENT_EMAIL
        remoteKey: mycure-production-storage-client-email
      - secretKey: STORAGE_DIRECTORY
        remoteKey: mycure-production-storage-directory
      - secretKey: STORAGE_PRIVATE_KEY
        remoteKey: mycure-production-storage-private-key
      - secretKey: STORAGE_PROJECT_ID
        remoteKey: mycure-production-storage-project-id
      - secretKey: STORAGE_TYPE
        remoteKey: mycure-production-storage-type
      # Stripe configuration
      - secretKey: STRIPE_KEY
        remoteKey: mycure-production-stripe-key
      - secretKey: STRIPE_CHECKOUT_SUCCESS_URL
        remoteKey: mycure-production-stripe-checkout-success-url
      - secretKey: STRIPE_CHECKOUT_CANCEL_URL
        remoteKey: mycure-production-stripe-checkout-cancel-url

  mongodb:
    external: false # Use in-cluster MongoDB
    enabled: true
    serviceName: mongodb
    database: hapihub
    username: root
    replicaSet: rs0

# ===== HEALTHCARE: Frontend Application =====
mycure:
  enabled: true

  image:
    repository: ghcr.io/mycurelabs/mycureapp
    tag: "10.3.9"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  gateway:
    hostname: ""
    sectionName: https-lfh # Use localfirsthealth.com HTTPS listener

  config:
    API_URL: "https://hapihub.localfirsthealth.com"
    HAPIHUB_URL: "https://hapihub.localfirsthealth.com"

  podDisruptionBudget:
    enabled: false

# ===== HEALTHCARE: MyCure Local Frontend Application =====
mycurelocal:
  enabled: true

  image:
    repository: ghcr.io/mycurelabs/mycurelocal
    tag: "1.1.2"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  gateway:
    hostname: ""
    sectionName: https-lfh # Use localfirsthealth.com HTTPS listener

  podDisruptionBudget:
    enabled: false

# ===== HEALTHCARE: MyCure MyAccount Application =====
mycure-myaccount:
  enabled: true

  image:
    repository: ghcr.io/mycurelabs/myaccount
    tag: "1.0.0"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  gateway:
    hostname: ""
    sectionName: https-lfh # Use localfirsthealth.com HTTPS listener

  config:
    API_URL: "https://hapihub.localfirsthealth.com"
    HAPIHUB_URL: "https://hapihub.localfirsthealth.com"

  podDisruptionBudget:
    enabled: false

# ===== HEALTHCARE: DentaLemon MyAccount Application =====
dentalemon-myaccount:
  enabled: false

  image:
    repository: ghcr.io/mycurelabs/dentalemon-myaccount
    tag: "1.0.9"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  gateway:
    hostname: ""
    sectionName: https-lfh # Use localfirsthealth.com HTTPS listener

  config:
    API_URL: "https://hapihub.localfirsthealth.com"
    HAPIHUB_URL: "https://hapihub.localfirsthealth.com"

  podDisruptionBudget:
    enabled: false

# ===== HEALTHCARE: MyCure DeployDash Application =====
mycure-deploydash:
  enabled: true

  image:
    repository: ghcr.io/mycurelabs/deploydash
    tag: "10.0.5"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  gateway:
    hostname: ""
    sectionName: https-lfh # Use localfirsthealth.com HTTPS listener

  config:
    API_URL: "https://hapihub.localfirsthealth.com"
    HAPIHUB_URL: "https://hapihub.localfirsthealth.com"

  podDisruptionBudget:
    enabled: false

# ===== HEALTHCARE: Frontend Application (v8 Legacy) =====
mycurev8:
  enabled: true

  image:
    repository: ghcr.io/mycurelabs/mycureapp
    tag: "8.24.4"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  gateway:
    hostname: ""
    sectionName: https-lfh # Use localfirsthealth.com HTTPS listener

  config:
    API_URL: "https://hapihub.localfirsthealth.com"
    HAPIHUB_URL: "https://hapihub.localfirsthealth.com"

  podDisruptionBudget:
    enabled: false

# ===== HEALTHCARE: DentaLemon Website =====
dentalemon-website:
  enabled: false

  image:
    repository: ghcr.io/mycurelabs/dentalemon-website
    tag: "0.3.1"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  gateway:
    hostname: ""
    sectionName: https-lfh
    gatewayName: nginx-shared-gateway
    gatewayNamespace: nginx-gateway-system

  networkPolicy:
    enabled: true

  config:
    API_URL: "https://hapihub.localfirsthealth.com"
    ACCOUNT_URL: "https://dentalemon-myaccount.localfirsthealth.com"

  podDisruptionBudget:
    enabled: false

# ===== HEALTHCARE: DentaLemon Dental Application =====
dentalemon:
  enabled: false

  image:
    repository: ghcr.io/mycurelabs/dentalemonapp
    tag: "10.8.6"
    pullPolicy: IfNotPresent

  replicaCount: 1

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  gateway:
    hostname: ""
    sectionName: https-lfh # Use localfirsthealth.com HTTPS listener

  config:
    API_URL: "https://hapihub.localfirsthealth.com"
    HAPIHUB_URL: "https://hapihub.localfirsthealth.com"

  podDisruptionBudget:
    enabled: false

# ===== HEALTHCARE: SyncD Real-time Synchronization =====
syncd:
  enabled: true

  image:
    repository: ghcr.io/mycurelabs/syncd
    tag: "5.130.34"
    pullPolicy: IfNotPresent

  replicaCount: 5

  resources:
    requests:
      cpu: 250m
      memory: 384Mi
    limits:
      cpu: "2"
      memory: 4Gi

  gateway:
    hostname: ""
    sectionName: https-lfh # Use localfirsthealth.com HTTPS listener

  livenessProbe:
    enabled: true

  readinessProbe:
    enabled: true

  podDisruptionBudget:
    enabled: false

  autoscaling:
    enabled: true
    maxReplicas: 5

  externalSecrets:
    enabled: true
    secretStore: gcp-secretstore
    secretStoreKind: ClusterSecretStore
    refreshInterval: 1h
    secrets:
      # MongoDB URI (managed DigitalOcean - shared with hapihub)
      - secretKey: MONGO_URI
        remoteKey: mycure-production-mongo-uri
      # Encryption keys (same as hapihub)
      - secretKey: ENC_BILLING_INVOICES
        remoteKey: mycure-production-enc-billing-invoices
      - secretKey: ENC_BILLING_ITEMS
        remoteKey: mycure-production-enc-billing-items
      - secretKey: ENC_BILLING_PAYMENTS
        remoteKey: mycure-production-enc-billing-payments
      - secretKey: ENC_MEDICAL_RECORDS
        remoteKey: mycure-production-enc-medical-records
      - secretKey: ENC_PERSONAL_DETAILS
        remoteKey: mycure-production-enc-personal-details

  mongodb:
    external: false # Use in-cluster MongoDB
    enabled: true
    serviceName: mongodb
    database: hapihub
    username: root
    replicaSet: rs0

# ===== DATABASE: PostgreSQL =====
postgresql:
  enabled: false # Disabled - API application not in use

  fullnameOverride: "postgresql"

  architecture: standalone

  image:
    repository: bitnamilegacy/postgresql
    tag: 16.4.0-debian-12-r13

  auth:
    enabled: true
    existingSecret: postgresql
    secretKeys:
      adminPasswordKey: postgres-password

  persistence:
    enabled: true
    storageClass: ""
    size: 20Gi

  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 1Gi

  podDisruptionBudget:
    enabled: false

# ===== DATABASE: MongoDB =====
mongodb:
  enabled: true # Self-hosted MongoDB in Kubernetes

  fullnameOverride: "mongodb"

  architecture: replicaset
  replicaCount: 1

  image:
    repository: bitnamilegacy/mongodb
    tag: 7.0.15-debian-12-r0

  auth:
    rootUser: root
    existingSecret: mongodb

  arbiter:
    enabled: false

  livenessProbe:
    enabled: true
    timeoutSeconds: 30
    periodSeconds: 30
    failureThreshold: 10

  readinessProbe:
    enabled: true
    timeoutSeconds: 20
    periodSeconds: 20
    failureThreshold: 10

  persistence:
    enabled: true
    storageClass: ""
    size: 100Gi

  resources:
    requests:
      cpu: 1000m
      memory: 5Gi
    limits:
      cpu: 2000m
      memory: 5Gi

  podDisruptionBudget:
    enabled: false

# ===== CACHE: Valkey (Redis) =====
valkey:
  enabled: false

  architecture: standalone

  image:
    repository: bitnamilegacy/valkey
    tag: 8.0.1-debian-12-r2

  master:
    persistence:
      enabled: true
      storageClass: ""
      size: 4Gi

  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 250m
      memory: 256Mi

# ===== STORAGE: MinIO Object Storage =====
minio:
  enabled: false

  fullnameOverride: "minio"

  image:
    repository: bitnamilegacy/minio
    tag: "2025.7.23-debian-12-r3"

  mode: standalone

  statefulset:
    replicaCount: 1

  auth:
    existingSecret: minio

  persistence:
    enabled: true
    storageClass: ""
    size: 10Gi

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  defaultBuckets: "monobase-files"

  buckets:
    - name: "monobase-files"
  region: "us-east-1"

  podSecurityContext:
    enabled: true
    fsGroup: 1001
    fsGroupChangePolicy: "OnRootMismatch"

  containerSecurityContext:
    enabled: true
    runAsUser: 1001
    runAsGroup: 1001
    runAsNonRoot: true
    privileged: false
    readOnlyRootFilesystem: true
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    seccompProfile:
      type: RuntimeDefault

  gateway:
    enabled: true
    hostname: ""
    rateLimit:
      enabled: false

# ===== EMAIL TESTING: Mailpit =====
mailpit:
  enabled: false

  resources:
    requests:
      cpu: 25m
      memory: 32Mi
    limits:
      cpu: 100m
      memory: 64Mi

  gateway:
    enabled: true
    hostname: ""

# ===== BACKUP =====
backup:
  enabled: false

# ===== SECURITY =====
podSecurityStandards:
  enabled: true
  level: restricted

# ===== RESOURCE QUOTAS =====
resourceQuotas:
  enabled: false
